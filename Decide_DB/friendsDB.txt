"""
	The 'friends' table comes with 3 seperate columns. 
		friends_id is for the friends id number
		Fk_user is for the users id number
		status is for the status of Fk_user's and friends_id's relationship
			0 = Pending
			1 = Accepted
"""
--
-- Dumping data for table 'Friends'
--

DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `addFriend`(IN userid int(11), IN friendid int(11), IN newstatus int(1))
BEGIN
	INSERT INTO Friends (Fk_user, Fk_friend, status) VALUES (userid, friendid, newstatus);
END ;;
DELIMITER ;


DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `getFriends`(IN userid int(11))
BEGIN
	SELECT u.firstname, u.lastname, u.email
    FROM Friends f JOIN User u ON u.user_id=f.Fk_friend
    WHERE f.Fk_user = userid;
END ;;
DELIMITER ;


DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `deleteFriend`(IN userid int(11), IN friendid int(11))
BEGIN
	DELETE from Friends
    WHERE Fk_user = userid AND Fk_friend = friendid;
END ;;
DELIMITER ;


DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `updateFriend`(IN friendid int(11), IN userid int(11), IN newstatus int(11))
BEGIN
	UPDATE Friends
   	SET status = newstatus 
	WHERE Fk_friend = friendid AND Fk_user = userid;
END ;;
DELIMITER ;


DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `getPendingFriends`(IN userid int(11))
BEGIN
	SELECT u.firstname, u.lastname, u.email
    FROM Friends f JOIN User u ON u.user_id=f.Fk_friend
    WHERE f.Fk_friend = userid AND f.status = 0;
END ;;
DELIMITER ;



--
-- Example from https://www.codedodle.com/2014/12/social-network-friends-database.html
--
INSERT INTO 'friends' ('friends_id', 'Fk_user', 'status') 
	VALUES (1, 2, 0)
	

UPDATE 'friends' SET 'status' = 1
	WHERE 'Fk_user' = 1 AND 'friends_id' = 2
	
  
SELECT * FROM 'friends'
	WHERE 'Fk_user' = 1 AND 'friends_id' = 2 
	AND 'status' = 1
	
	
SELECT * FROM 'friends'
	WHERE ('Fk_user' = 1 OR 'friends_id' = 1)
	AND 'status' = 1
	
SELECT * FROM 'friends'
	WHERE ('Fk_user' = 1 OR 'friends_id' = 1)
	AND 'status' = 0